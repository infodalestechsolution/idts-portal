<!DOCTYPE html>
<html lang="en">

<head>
	<title>Query Builder in AEM</title>
	<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="In Adobe Experience Manager (AEM), a Query Builder is a powerful and flexible tool that allows us to create and execute queries to retrieve content from the AEM repository. It provides a structured and efficient way to search for specific content based on various criteria.">
    <meta name="keywords" content="Infodales, Query Builder in AEM, Query, Predicates, AEM">
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Query Builder in AEM" />
    <meta property="og:description" content="In Adobe Experience Manager (AEM), a Query Builder is a powerful and flexible tool that allows us to create and execute queries to retrieve content from the AEM repository. It provides a structured and efficient way to search for specific content based on various criteria." />
    <meta property="og:url" content="https://infodales.com/blogs/query-builder.html" />
    <meta property="og:site_name" content="Query Builder in AEM" />
	<link rel="stylesheet" href="/style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;600;700&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>

	<!-- Header -->
	<section class="sub-header"
		style="background-image: linear-gradient(rgba(4, 9, 30, 0.5), rgba(4, 9, 30, 0.5)), url('/images/Cover\ Sites.jpg');">
		<nav>
			<a href="/index.html"><img src="/images/infodales/Info Dales Main Logo 03.webp" alt="logo"></a>
			<div class="nav-links" id="navLinks">
				<i class="fa fa-times" onclick="hideMenu()"></i>
				<ul>
					<li><a href="/index.html">HOME</a></li>
					<li><a href="/about.html">ABOUT</a></li>
					<li><a href="/services.html">SERVICES</a></li>
					<li><a href="/blog.html">BLOGS</a></li>
					<li><a href="/career.html">CAREER</a></li>
					<li><a href="/contact.html">CONTACT</a></li>
					<ul>
			</div>
			<i class="fa fa-bars" onclick="showMenu()"></i>
		</nav>
	</section>
	<!--  Blog Page Content --->
	<section class="blog-content">
		<div>
			<div class="blog">
                <p style="color: rgb(133, 133, 133); padding: 0 0 10px 0;"><a href="/blog.html" style="text-decoration: none; cursor: pointer;">Blogs</a> <span> > </span>Query Builder in AEM</p>
                <p class="sitesTag" style="margin-top: 7px; margin-bottom: 7px; font-size: 13px; border-radius: 20px; 
                width: fit-content; padding: 3px 15px;">AEM Sites</p>
                <h1 class="title">Query Builder in AEM</h1>
                <span class="author">Infodales Tech Solutions</span> |
                <span class="date">May 23, 2023</span>
                <div class="share-icons">
                <a href="https://www.linkedin.com/in/infodales-tech-solutions-928b21284/" target="_blank" class="linkedin-icon"><i class="fa fa-linkedin"></i></a>
                <a href="mailto:info@infodales.com" target="_blank" class="email-icon"><i class="fa fa-envelope"></i></a>
                </div>
                    <hr style="margin: 20px 0 10px 0;">            
                <!-- <div class="image-container">
                <img src="images/cover.webp" alt="Image Description">
                </div> -->

                <div class="blog-items">
                    <p>If we talk about the Search APIs available in AEM, we have two options available with us i.e., Query Builder and JCR SQL2. We&apos;ll look into the query builder concept in this blog and get all the questions related to this topic cleared. So, let&apos;s get started.</p>
                    <div>
                        <h3 style="text-align: left;">Query Builder</h3>
                        <p>In Adobe Experience Manager (AEM), a Query Builder is a powerful and flexible tool that allows us to create and execute queries to retrieve content from the AEM repository. It provides a structured and efficient way to search for specific content based on various criteria.</p>
                        <p>The Query Builder uses SQL-like syntax, but it's specifically designed for querying the AEM repository. We can build queries using a web-based interface or by constructing queries programmatically using the QueryBuilder API. It basically simplifies the process of searching for content and enables users to define complex queries with conditions and filters.</p>
                        <p>For example, we could ask the Query Builder to find all pages of a certain type in a specific part of our website. It's a handy tool for quickly locating and working with the content we're interested in within AEM.</p>
                        <p>We have a Query Builder Debugger Tool which can be used to execute the search queries on the JCR (Java Content Repository). We can use this tool for dry run purposes for our AEM queries.</p>
                        <p>AEM Query Builder debugger URL: <br><a href="http://localhost:4502/libs/cq/search/content/querydebug.html" target="_blank" style="overflow-wrap: break-word;">http://localhost:4502/libs/cq/search/content/querydebug.html</a></p>
                        <img class="spa-image" src="/images/query builder/query builder console.png" alt="Query debugger console">
                        <p>In the Query builder console, run a simple query like: <br>
                        <i style="color: gray;">type = cq:Page </i><br>
                        This query will provide us all the nodes having their primary type as cq:Page and we will get the search results in the form of hits.
                        </p>
                        <img class="spa-image" src="/images/query builder/query debugger console.png" alt="Query debugger console" width="800" height="450">
                        <p>Query builder comprises of queries, so let&apos;s just look into what all a query consists of:</p>
                        <ol style="margin-left: auto; width: 93%;">
                            <li><p>Predicates - If we don't provide any parameter, the predicate type is mirrored in the final query.</p></li>
                            <li><p>Parameters - Predicate parameter</p></li>
                            <li><p>Value - Value of predicate</p></li>
                        </ol>
                        <img class="spa-image" src="/images/query builder/query.png" alt="Query" width="600" height="300">
                    </div>
                    <div>
                        <h3 style="text-align: left;">List of Standard predicates</h3>
                        <p>Here&apos;s the list of available standard predicates that we&apos;ll be using to write our query.</p>
                        <ul style="margin-left: auto; width: 93%;">
                            <li><p><strong>type :</strong> It is used for searching a particular type of node only. For ex. cq:Page, dam:Asset, nt:unstructured, etc.</p></li>
                            <li>
                                <p><strong>path :</strong> It defines a particular path or hierarchy that needs to be searched.</p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>path.self = true :</strong> If true, it searches the sub nodes including the main node given in the path and if false, it searches the sub nodes only.</p></li>
                                    <li><p><strong>path.exact = true :</strong> If it is true, the exact path is matched, if false all the descendants are included.</p></li>
                                    <li><p><strong>path.flat = true :</strong> If true, then it searches the direct children only.</p></li>
                                </ul>
                            </li>
                            <li>
                                <p><strong>property :</strong> This is used for search based on JCR property.</p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>property.value :</strong> It defines the property value to be searched. Multiple values of the particular property could be given using n_property.value = xyz.</p></li>
                                    <li><p><strong>property.depth :</strong> It is used to specify the number of levels to search beneath a node. For example, when  property.depth is set to 3, the search extends up to 3 levels below the base node. This parameter is mostly used for nested search.</p></li>
                                    <li><p><strong>property.and :</strong> In the case of multiple properties, the default behavior involves applying an OR operator. To switch to an AND operator set  property.and = true.</p></li>
                                    <li>
                                        <p><strong>property.operation :</strong> equals, unequals, like, not, exists.</p>
                                        <ul style="margin-left: auto; width: 93%;">
                                            <li><p>“equals” for exact match (default)</p></li>
                                            <li><p>“unequals” for unequality comparison</p></li>
                                            <li><p>“like” for using the jcr:like xpath function</p></li>
                                            <li><p>“not” for no match, (value param will be ignored)</p></li>
                                            <li><p>“exists” for existence matches. (value can be true – property must exist).</p></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <p><strong>fulltext :</strong> used for full text search</p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>fulltext.relPath :</strong> can specify the relative path to search in (eg. property or subnode)</p></li>
                                </ul>
                            </li>
                            <li>
                                <p><strong>daterange :</strong> This predicate facilitates searching within a date property range. </p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>daterange.property :</strong> Specify the date property on which query needs to run.</p></li>
                                    <li><p><strong>daterange.lowerBound :</strong> Fix a lower bound date range eg. 2020-08-31</p></li>
                                    <li><p><strong>daterange.lowerOperation :</strong> “>” (default) or “>=”</p></li>
                                    <li><p><strong>daterange.upperBound :</strong> Fix a upper bound date range eg. 2023-01-25</p></li>
                                    <li><p><strong>daterange.upperOperation :</strong> “<” (default) or “<=”</p></li>
                                </ul>
                            </li>
                            <li>
                                <p><strong>relativedaterange :</strong> It is an extension of daterange which uses relative offsets to server time. It also supports 1s 2m 3h 4d 5w 6M 7y.</p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>relativedaterange.lowerBound :</strong> Lower bound offset, default=0</p></li>
                                    <li><p><strong>relativedaterange.upperBound :</strong> Upper bound offset.</p></li>
                                </ul>
                            </li>
                            <li><p><strong>nodename :</strong> This is used to search exact node names within the result set. It allows certain wildcards, such as nodename = text*, which searches for "text" and any characters following it. Similarly, nodename = text? looks for all records starting with "text" but excludes results containing only "text."</p></li>
                            <li>
                                <p><strong>tagid :</strong> This predicate is used to search for a specific tag on a page by specifying its exact tagid. (Note:- It searches for tags within /etc/tags, so the service user used for the query must have access to this path as well.)</p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>tagid.property :</strong> this can be used to specify the path of node where tags are stored.</p></li>
                                </ul>
                            </li>
                            <li><p><strong>tagsearch :</strong> It searches for matching tag.</p></li>
                            <li><p><strong>mainasset :</strong> mainasset=true means search only Dam Asset and not the subassets.</p></li>
                            <li><p><strong>group :</strong> This predicate is used to create logical conditions in your query. You can create complex conditions using OR & AND operators in different groups.</p></li>
                            <li>
                                <p><strong>orderBy :</strong>  This predicate is used to sort the result sets obtained in the query. e.g. orderby=@jcr:score or orderby=@jcr:content/cq:lastModified</p>
                                <ul style="margin-left: auto; width: 93%;">
                                    <li><p><strong>orderby.sort :</strong> You may define the sorting way for the search results e.g. orderby.desc=true  or orderby.sort = desc for descending and orderby.asc=true or orderby.sort=asc for ascending.</p></li>
                                    <li><p><strong>orderby.case :</strong> support case insensitive orderby.case=ignore (since 6.2)</p></li>
                                    <li><p><strong>orderby=my predicate (eg: orderby=path) :</strong> this can also be used to sort by path.</p></li>
                                </ul>
                            </li>
                            <li><p><strong>p.hits=full :</strong> Use this when you want to return all the properties in a node.</p></li>
                            <li><p><strong>p.hits=selective :</strong> Use this if you want to return selective properties in search results. Use this with p.properties=sling:resourceType jcr:primaryType Example :- p.properties = jcr:path</p></li>
                            <li><p><strong>p.nodedepth :</strong> Use this when you need properties of a node and its child nodes in the same search result. Use this with p.hits=full</p></li>
                            <li><p><strong>p.facets=true :</strong> This will be used to Search Facets based search for the assigned Query. If you want to calculate the count of tags which are present in your search result or you want to know how many templates for a particular page are there etc, you may go with Facets based search.</p></li>
                            <li><p><strong>p.guesstotal :</strong> The purpose of the p.guessTotal parameter is to return the appropriate number of results that can be shown by combining the minimum viable p.offset and p.limit values. The advantage of using this parameter is improved performance with large result sets. This avoids calculating the full total (e.g calling result.getSize()) and reading the entire result set.</p></li>
                            <li><p><strong>p.offset :</strong> defines start of index means from which index you want to fetch records from query result.</p></li>
                            <li><p><strong>p.limit :</strong> defines page size. In simple words how many records you want to fetch. Each query result will display results from p.offset to p.offset + p.limit.</p></li>
                        </ul>
                    </div>
                    <div class="query-pre-tag">
                        <h3 style="text-align: left;">Query Builder JAVA API</h3>
                        <p>Now that we&apos;ve gone through the number of standard predicates available with us, let&apos;s use these queries in our java code and get the required result via Java API.</p>
                        <p>We can use AEM queries in three ways in java:</p>
                        <ol style="margin-left: auto; width: 93%;">
                            <li>
                                <p><strong>Using HTTP request</strong></p>
                                <pre style="height: 100px;">
<code style="width: 100%;"><i>Session session = request.getResourceResolver().adaptTo(Session.class);
PredicateGroup root = PredicateGroup.create(request.getParameterMap());
Query query = queryBuilder.createQuery(root, session);</i>
</code></pre>
                            </li>
                            <li>
                                <p><strong>Using Predicates</strong></p>
                                <pre style="height: 120px;">
<code style="width: 100%;"><i>PredicateGroup group = new PredicateGroup();
group.add(new Predicate("mypath", "path").set("path", "/content/mysite"));
group.add(new Predicate("mytype", "type").set("type", "cq:Page"));
Query query = queryBuilder.createQuery(group, session);</i>
</code></pre>
                            </li>
                            <li>
                                <p><strong>Using Hash Map</strong></p>
                                <pre style="height: 120px;">
<code style="width: 100%;"><i>Map<String, String> predicateMap = new HashMap();
predicateMap.put("path", "/content/mysite");
predicateMap.put("type", "cq:Page");
Query query = queryBuilder.createQuery(PredicateGroup.create(predicateMap), session);</i>
</code></pre>
                            </li>
                        </ol>
                        <p>When we get the query, we can simply get the search results in the form of hits and we can iterate over the list of results i.e., hits and use that result in our java code.</p>
                        <pre>
<code style="width: 100%;">//Get search results
SearchResult result = query.getResult();
List<Hit> resultList = result.getHits();

//Iterate query results
for (Hit hit : resultList ) {
    // Write your logic here
}</code>
                        </pre>
                    </div>
                    <p>Hope you got the concept of query builder and how to write queries and use those queries in our java code as well. We&apos;ll go through some sample set of examples of creating queries in the next blog.</p>
                    <p>Thanks for reading! &#128516;</p>
                </div>
            
                <hr style="margin-top: 30px;">
                <div class="author-details">
                <div id="like-icon" class="like-icon">
                    <span id="like-count" class="like-count">0</span>
                    <span id="like-btn" class="like-btn">
                    <img src="/images/clap.webp" alt="Like">
                    </span>
                </div>
                <div>
                    <span class="author-name">Suchita Mishra | </span>
                    <span class="author-designation">AEM Developer</span>
                </div>
                </div>
            </div>
		</div>
	</section>

<div class="social-icons">
	 
	<a href="https://www.linkedin.com/company/infodales-tech-solution/" class="linkedin"><img src="/images/linkedin.webp" alt="LinkedIn"></a>
	<a href="mailto:info@infodales.com" class="email"><img src="/images/email.webp" alt="Email"></a>
</div>

	<!--  Footer --->
	<div class="copyright-area">
		<div class="footer">
			<div class="row" style="margin-top: 0px;">
				<div class="col-xl-4 col-lg-4 text-center text-lg-left">
					<div class="copyright-text">
						<p>Copyright &copy; 2023, All Right Reserved <a href="/index.html">Infodales Tech
								Solution</a></p>
					</div>
				</div>
				
				<div class="col-xl-4 col-lg-4 d-none d-lg-block text-right">
					<div class="footer-menu" style="margin-top:10px;">
						<ul>
							<li><a href="/index.html">Home</a></li>
							<li><a href="/about.html">About</a></li>
							<li><a href="/contact.html">Contact</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!--- Java Script-->
	<script>
		var navLinks = document.getElementById("navLinks");

		function showMenu() {
			navLinks.style.right = "0";
		}

		function hideMenu() {
			navLinks.style.right = "-200px";
		}

		document.addEventListener("DOMContentLoaded", () => {
    const likeBtn = document.getElementById('like-btn');
    const likeCount = document.getElementById('like-count');

    let count = parseInt(localStorage.getItem('clapCount')) || 0;
    likeCount.textContent = count;

    likeBtn.addEventListener('click', () => {
        count++;
        likeCount.textContent = count;
        localStorage.setItem('clapCount', count);

        const likeAnimation = document.createElement('div');
        likeAnimation.classList.add('like-animation');
        likeAnimation.innerHTML = '🎉';
        document.getElementById('like-icon').appendChild(likeAnimation);
        likeAnimation.addEventListener('animationend', () => {
            likeAnimation.remove();
        });
    });
});


	</script>

</body>

</html>